#include "output.h"

DEFINE_GRADIENT_PALETTE(dimDefaultFlamePalette) {
  0,    0, 0, 0,        // Black
  150,  127, 38, 0,     // Dark Orange
  200,  127, 75, 0,     // Orange
  230,  127, 127, 127,  // White
  240,  75, 75, 125,    // Light Blue
  255,  35, 35, 125     // Light Blue
};

DEFINE_GRADIENT_PALETTE(brightDefaultFlamePalette) {
  0,    0, 0, 0,        // Black
  150,  255, 77, 0,     // Dark Orange
  200,  255, 150, 0,    // Orange
  230,  255, 255, 255,  // White
  240,  150, 150, 255,  // Light Blue
  255,  75, 75, 255     // Light Blue
};

DEFINE_GRADIENT_PALETTE(popDefaultFlamePalette) {
  0,    0, 0, 0,        // Black
  70,   60, 20, 5,      // Dark Brown
  140,  100, 50, 10,    // Brown
  200,  200, 100, 15,   // Light Brown
  235,  255, 150, 25,   // Light Orange
  255,  255, 150, 50    // Light Orange
};

DEFINE_GRADIENT_PALETTE(dimBlueFlamePalette) {
  0,    0, 0, 0,        // Black
  150,  0, 0, 50,       // Dark Blue
  200,  0, 0, 100,      // Blue
  230,  50, 50, 150,    // Light Blue
  240,  100, 100, 200,  // Very Light Blue
  255,  150, 150, 255   // White
};

DEFINE_GRADIENT_PALETTE(brightBlueFlamePalette) {
  0,    0, 0, 0,        // Black
  150,  0, 0, 150,      // Dark Blue
  200,  50, 50, 200,    // Blue
  230,  100, 100, 255,  // Light Blue
  240,  150, 150, 255,  // Very Light Blue
  255,  200, 200, 255   // White
};

DEFINE_GRADIENT_PALETTE(popBlueFlamePalette) {
  0,    0, 0, 0,        // Black
  70,   0, 0, 100,      // Dark Blue
  140,  0, 0, 150,      // Blue
  200,  50, 50, 200,    // Light Blue
  235,  100, 100, 255,  // Very Light Blue
  255,  150, 150, 255   // White
};

DEFINE_GRADIENT_PALETTE(dimGreenFlamePalette) {
  0,    0, 0, 0,        // Black
  150,  0, 50, 0,       // Dark Green
  200,  50, 100, 0,     // Green
  230,  100, 150, 0,    // Yellow-Green
  240,  150, 200, 0,    // Light Yellow-Green
  255,  200, 255, 0     // Yellow
};

DEFINE_GRADIENT_PALETTE(brightGreenFlamePalette) {
  0,    0, 0, 0,        // Black
  150,  0, 100, 0,      // Dark Green
  200,  50, 150, 0,     // Green
  230,  100, 200, 0,    // Yellow-Green
  240,  150, 255, 0,    // Light Yellow-Green
  255,  200, 255, 50    // Yellow
};

DEFINE_GRADIENT_PALETTE(popGreenFlamePalette) {
  0,    0, 0, 0,        // Black
  70,   0, 50, 0,       // Dark Green
  140,  50, 100, 0,     // Green
  200,  100, 150, 0,    // Yellow-Green
  235,  150, 200, 0,    // Light Yellow-Green
  255,  200, 255, 50    // Yellow
};

DEFINE_GRADIENT_PALETTE(dimPurplePinkPalette) {
  0,    0, 0, 0,        // Black
  150,  64, 0, 64,      // Dark Purple
  200,  128, 0, 128,    // Purple
  230,  192, 0, 192,    // Magenta
  240,  224, 128, 224,  // Light Magenta
  255,  255, 192, 203   // Pink
};

DEFINE_GRADIENT_PALETTE(brightPurplePinkPalette) {
  0,    0, 0, 0,        // Black
  150,  128, 0, 128,    // Dark Purple
  200,  192, 0, 192,    // Purple
  230,  255, 0, 255,    // Magenta
  240,  255, 128, 255,  // Light Magenta
  255,  255, 192, 203   // Pink
};

DEFINE_GRADIENT_PALETTE(popPurplePinkPalette) {
  0,    0, 0, 0,        // Black
  70,   64, 0, 64,      // Dark Purple
  140,  128, 0, 128,    // Purple
  200,  192, 0, 192,    // Magenta
  235,  224, 128, 224,  // Light Magenta
  255,  255, 192, 203   // Pink
};

DEFINE_GRADIENT_PALETTE(dimCyanWhitePalette) {
  0,    0, 0, 0,        // Black
  150,  0, 64, 64,      // Dark Cyan
  200,  0, 128, 128,    // Cyan
  230,  128, 192, 192,  // Light Cyan
  240,  192, 224, 224,  // Very Light Cyan
  255,  255, 255, 255   // White
};

DEFINE_GRADIENT_PALETTE(brightCyanWhitePalette) {
  0,    0, 0, 0,        // Black
  150,  0, 128, 128,    // Dark Cyan
  200,  0, 192, 192,    // Cyan
  230,  128, 255, 255,  // Light Cyan
  240,  192, 255, 255,  // Very Light Cyan
  255,  255, 255, 255   // White
};

DEFINE_GRADIENT_PALETTE(popCyanWhitePalette) {
  0,    0, 0, 0,        // Black
  70,   0, 64, 64,      // Dark Cyan
  140,  0, 128, 128,    // Cyan
  200,  0, 192, 192,    // Light Cyan
  235,  128, 255, 255,  // Very Light Cyan
  255,  255, 255, 255   // White
};

DEFINE_GRADIENT_PALETTE(dimRainbowPalette) {
  0,    0, 0, 0,        // Black
  51,   127, 0, 0,      // Dark Red
  102,  127, 63, 0,     // Dark Orange
  153,  127, 127, 0,    // Dark Yellow
  204,  0, 127, 0,      // Dark Green
  255,  0, 0, 127       // Dark Blue
};

DEFINE_GRADIENT_PALETTE(brightRainbowPalette) {
  0,    0, 0, 0,        // Black
  51,   255, 0, 0,      // Red
  102,  255, 127, 0,    // Orange
  153,  255, 255, 0,    // Yellow
  204,  0, 255, 0,      // Green
  255,  0, 0, 255       // Blue
};

DEFINE_GRADIENT_PALETTE(popRainbowPalette) {
  0,    0, 0, 0,        // Black
  51,   127, 0, 0,      // Dark Red
  102,  191, 63, 0,     // Orange
  153,  255, 127, 0,    // Yellow
  204,  127, 255, 0,    // Green
  255,  0, 127, 255     // Blue
};

CRGBPalette16 getDimPalette(ExhaustPalette palette) {
  switch (palette) {
    case DEFAULT_EXHAUST_PALETTE:
      return dimDefaultFlamePalette;
    case BLUE_EXHAUST_PALETTE:
      return dimBlueFlamePalette;
    case GREEN_EXHAUST_PALETTE:
      return dimGreenFlamePalette;
    case PURPLE_EXHAUST_PALETTE:
      return dimPurplePinkPalette;
    case CYAN_EXHAUST_PALETTE:
      return dimCyanWhitePalette;
    case RAINBOW_EXHAUST_PALETTE:
      return dimRainbowPalette;
    default:      
      return dimDefaultFlamePalette;
  }
}

CRGBPalette16 getBrightPalette(ExhaustPalette palette) {
  switch (palette) {
    case DEFAULT_EXHAUST_PALETTE:
      return brightDefaultFlamePalette;
    case BLUE_EXHAUST_PALETTE:
      return brightBlueFlamePalette;
    case GREEN_EXHAUST_PALETTE:
      return brightGreenFlamePalette;
    case PURPLE_EXHAUST_PALETTE:
      return brightPurplePinkPalette;
    case CYAN_EXHAUST_PALETTE:
      return brightCyanWhitePalette;
    case RAINBOW_EXHAUST_PALETTE:
      return brightRainbowPalette;
    default:
      return brightDefaultFlamePalette;
  }
}

CRGBPalette16 getPopPalette(ExhaustPalette palette) {
  switch (palette) {
    case DEFAULT_EXHAUST_PALETTE:
      return popDefaultFlamePalette;
    case BLUE_EXHAUST_PALETTE:
      return popBlueFlamePalette;
    case GREEN_EXHAUST_PALETTE:
      return popGreenFlamePalette;
    case PURPLE_EXHAUST_PALETTE:
      return popPurplePinkPalette;
    case CYAN_EXHAUST_PALETTE:
      return popCyanWhitePalette;
    case RAINBOW_EXHAUST_PALETTE:
      return popRainbowPalette;
    default:  
      return popDefaultFlamePalette;
  }
}

CRGBPalette16 getExhaustPalette(ExhaustPalette palette, FlameType type) {
  switch (type) {
    case DIM_FLAME:
      return getDimPalette(palette);
    case BRIGHT_FLAME:
      return getBrightPalette(palette);
    case POP_FLAME:
      return getPopPalette(palette);
    default:
      return getDimPalette(palette);
  }
}

void showExhaustFlame(State* state, int channel){
    OutputChannelConfig channelCfg = state->config.outputConfig.channelConfigs[channel];
    LevelConfig levelCfg = state->config.levelConfigs[state->inputState.level];

    if(!state->inputState.enabled || !levelCfg.animations.exhaustFlame ||
        state->animationState.flame.intensity == 0 || state->animationState.flame.type == NO_FLAME){
        clearStrip(channel);
        return;
    }

    uint8_t mappedIntensity = map(state->animationState.flame.intensity,0,MAX_EXHAUST_INTENSITY,0,255);
    CRGBPalette16 flamePalette = getExhaustPalette(channelCfg.exhaustConfig.palette, state->animationState.flame.type);
    CRGB flameColor = ColorFromPalette(flamePalette, mappedIntensity);
    flameColor = reorderColor(flameColor, channelCfg.colorOrder);
    for(int i=0; i<NUM_STRIP_LEDS; i++){
        setLedColor(channel, i, flameColor);
    }
}